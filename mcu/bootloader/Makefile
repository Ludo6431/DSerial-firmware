# DSerial Bootloader Makefile

# Additional directories to search for include files
INCLUDES := -I.

# Flags provided to SDCC compiler
CFLAGS := -c -V --model-large $(INCLUDES)

# Flags provided to SDCC linker
LFLAGS := -V --code-loc 0x0000 --code-size 62464 --xram-size 4096 --iram-size 256

# Default target to build
all: bootloader.hex

# Object files to be linked separated by spaces
OBJECTS := bootloader.rel

.SUFFIXES: .hex

# Links and builds the target hex file
bootloader.hex: $(OBJECTS)
	sdcc $(LFLAGS) $^
	packihx $*.ihx > $*.hex

# Compiles c files
%.rel: %.c
	sdcc $(CFLAGS) $<

# Compiles asm files (excluding asm files generated by SDCC)
%.rel: %.asm
	asx8051 -losa $<

# Cleans temporary files, leaves hex file
clean:
	rm -f *.rel *.lst *.lnk *.rst *.mem *.map *.sym *.ihx
